<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Christmas Card</title>
  <style>
    :root{
      --bg1:#07101f;
      --bg2:#0b1220;
      --card:#f2efea;
      --ink:#111;
      --link:#1f3bb3;
      --shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Microsoft YaHei", Arial, sans-serif;}
    body{
      overflow:hidden;
      background: linear-gradient(180deg, #0b1220, #050810);
      color:#fff;
      -webkit-text-size-adjust: 100%;
    }
    .bg-blur{
      position:fixed; inset:-40px;
      background:
        radial-gradient(900px 600px at 20% 35%, rgba(255,120,160,.22), transparent 60%),
        radial-gradient(900px 600px at 78% 60%, rgba(140,180,255,.14), transparent 62%),
        linear-gradient(180deg, #151c2b, #060914);
      filter: blur(14px) saturate(1.1);
      transform: scale(1.08);
      opacity:.75;
      pointer-events:none;
    }

    .cover{
      position:fixed; inset:0;
      display:grid;
      place-items:center;
      padding:24px;
      padding-top: calc(24px + env(safe-area-inset-top));
      padding-bottom: calc(24px + env(safe-area-inset-bottom));
      z-index:10;
      transition: opacity .45s ease, transform .55s ease;
    }
    .card{
      width:min(760px, 92vw);
      height:min(380px, 46vh);
      background: var(--card);
      border-radius: 18px;
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1.05fr 1fr;
      gap:22px;
      padding:34px 34px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(280px 220px at 20% 35%, rgba(255,90,90,.12), transparent 60%),
                  radial-gradient(320px 260px at 80% 70%, rgba(80,160,255,.14), transparent 62%);
      pointer-events:none;
    }

    .mc{
      color:var(--ink);
      font-weight:900;
      font-size: clamp(34px, 10.5vw, 54px);
      line-height: .9;
      letter-spacing:.5px;
      font-family: ui-rounded, "Comic Sans MS", "Bradley Hand", "Segoe Script", cursive;
      transform: rotate(-6deg);
      margin-top:6px;
      user-select:none;
    }
    .mc small{
      display:block;
      font-size: clamp(14px, 4.2vw, 18px);
      font-weight:700;
      margin-top:10px;
      opacity:.7;
      transform: rotate(6deg);
      font-family: system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
    }
    .right{
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:12px;
      color:#222;
      padding-left:8px;
      min-width:0;
    }
    .quote{ font-size: clamp(16px, 4.8vw, 20px); font-weight:700; }
    .sub{ font-size: clamp(14px, 4.2vw, 16px); opacity:.85; line-height:1.7; }

    .click{
      margin-top:8px;
      font-size: clamp(16px, 4.5vw, 18px);
      font-weight:800;
      color:var(--link);
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      width:max-content;
      padding:10px 14px;
      border-radius:12px;
      background: rgba(31,59,179,.08);
      transition: transform .15s ease, background .2s ease;
    }
    .click:hover{ transform: translateY(-1px); background: rgba(31,59,179,.12); }
    .click:active{ transform: translateY(1px); }

    body.open .cover{
      opacity:0;
      transform: translateY(-8px) scale(.98);
      pointer-events:none;
    }

    #scene{
      position:fixed; inset:0;
      display:block;
      opacity:0;
      transition: opacity .55s ease;
    }
    body.open #scene{ opacity:1; }

    .hint{
      position:fixed;
      top: calc(16px + env(safe-area-inset-top));
      left:50%;
      transform:translateX(-50%);
      font-size:14px;
      opacity:.78;
      z-index:2;
      pointer-events:none;
      text-shadow: 0 6px 18px rgba(0,0,0,.35);
      user-select:none;
      padding:0 12px;
      max-width:92vw;
      text-align:center;
    }
    .footer{
      position:fixed;
      bottom: calc(18px + env(safe-area-inset-bottom));
      left:50%;
      transform:translateX(-50%);
      font-size:16px;
      font-weight:700;
      opacity:.9;
      z-index:2;
      pointer-events:none;
      text-shadow: 0 6px 18px rgba(0,0,0,.35);
      user-select:none;
      padding:0 12px;
      max-width:92vw;
      text-align:center;
    }

    @media (max-width: 520px){
      .card{
        grid-template-columns: 1fr;
        height: auto;
        padding: 22px;
        gap: 14px;
      }
      .right{ padding-left:0; }
      .mc{ transform: rotate(-4deg); }
      .mc small{ transform: rotate(4deg); }
      .click{ width:100%; justify-content:center; }
    }
  </style>
</head>

<body>
  <div class="bg-blur"></div>

  <div class="cover">
    <div class="card">
      <div>
        <div class="mc">
          merry<br/>christmas
          <small>üéÑ ‚ú®</small>
        </div>
      </div>

      <div class="right">
        <div class="quote" id="toText">‚ÄúÊÑø‚ÄùÂπ≥ÂÆâÂñú‰πê</div>
        <div class="sub" id="subText">‰∏á‰∫ãÈ°∫ÈÅÇ</div>
        <div class="click" id="openBtn">
          <span id="clickText">ÁÇπÂáªÊúâÊÉäÂñú</span>
          <span aria-hidden="true">‚ñ∂</span>
        </div>
      </div>
    </div>
  </div>

  <canvas id="scene"></canvas>
  <div class="hint">ÊâìÂºÄÂêéÔºöÁÇπÂáª‰ªªÊÑèÂ§ÑÂàáÊç¢ÊóãËΩ¨ÈÄüÂ∫¶</div>
  <div class="footer">üéÅ Merry Christmas & Happy New Year ‚ú®</div>

<script>
(() => {
  // ---------- Canvas setup ----------
  const canvas = document.getElementById("scene");
  const ctx = canvas.getContext("2d");

  let W=0, H=0, DPR=1;

  function getViewportSize(){
    // ‚úÖ ÂÜÖÁΩÆÊµèËßàÂô®/ÊâãÊú∫Á´ñÂ±èÊõ¥Á®≥Ôºö‰ºòÂÖàÁî® visualViewport
    const vw = window.visualViewport?.width || window.innerWidth;
    const vh = window.visualViewport?.height || window.innerHeight;
    return { vw, vh };
  }

  function resize(){
    DPR = Math.min(2, window.devicePixelRatio || 1);

    const { vw, vh } = getViewportSize();
    W = Math.floor(vw);
    H = Math.floor(vh);

    canvas.width = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    canvas.style.width = W + "px";
    canvas.style.height = H + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
    buildAll();
  }

  window.addEventListener("resize", resize);
  window.visualViewport?.addEventListener("resize", resize);

  // ---------- Helpers ----------
  function rand(a,b){ return a + Math.random()*(b-a); }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function lerp(a,b,t){ return a + (b-a)*t; }
  function hexToRgb(hex){
    const h = hex.replace("#","").trim();
    return {r:parseInt(h.slice(0,2),16), g:parseInt(h.slice(2,4),16), b:parseInt(h.slice(4,6),16)};
  }
  function mix(c1,c2,t){
    return {
      r: Math.floor(lerp(c1.r,c2.r,t)),
      g: Math.floor(lerp(c1.g,c2.g,t)),
      b: Math.floor(lerp(c1.b,c2.b,t)),
    };
  }
  function rgba(c,a){ return `rgba(${c.r},${c.g},${c.b},${a})`; }

  // ---------- 3D-ish projection ----------
  const cam = { fov: 560, zoff: 560 };
  function project3D(x, y, z){
    const zz = z + cam.zoff;
    const s = cam.fov / (cam.fov + zz);
    return { x: x*s, y: y*s, s };
  }
  function rotY(x, z, a){
    const ca = Math.cos(a), sa = Math.sin(a);
    return { x: x*ca - z*sa, z: x*sa + z*ca };
  }

  function glowDot(x,y,r,color,alpha=1){
    ctx.save();
    ctx.globalAlpha = alpha;
    const g = ctx.createRadialGradient(x,y,0,x,y,r);
    g.addColorStop(0, color);
    g.addColorStop(1, "rgba(255,255,255,0)");
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  // ---------- Scene params ----------
  const tree = {
    height: 560,
    baseRadius: 230,
    topY: -260
  };

  // ---------- Particles ----------
  let snow = [];
  let treePts = [];
  let heartPts = [];
  let ringPts = [];
  let bgCode = [];

  const PINK = hexToRgb("#ff5b8a");
  const HOT  = hexToRgb("#ff2e63");
  const WHITE= hexToRgb("#ffffff");
  const WARM = hexToRgb("#ffe8f0");

  function buildSnow(){
    const n = Math.floor(Math.min(260, 140 + (W*H)/24000));
    snow = Array.from({length:n}, () => ({
      x: Math.random()*W,
      y: Math.random()*H,
      vy: rand(0.35, 1.6),
      vx: rand(-0.25, 0.25),
      r:  rand(0.8, 3.1),
      a:  rand(0.35, 0.95),
    }));
  }

  function buildTree(){
    // ‚úÖ Âè™Êîπ‚ÄúÊØî‰æã/‰ΩçÁΩÆ‚ÄùÔºå‰∏çÊîπÊ†ëÁöÑÁîüÊàêÊñπÂºèÔºàÊ†∑Â≠ê‰∏ç‰ºöÊç¢Ôºâ
    const portrait = H > W * 1.15; // Á´ñÂ±èÂà§ÂÆö
    tree.height = Math.min(680, H*(portrait ? 0.90 : 0.82));
    tree.baseRadius = Math.min(290, W*(portrait ? 0.32 : 0.24));
    tree.topY = -Math.min(320, H*(portrait ? 0.30 : 0.26));

    const N = 5200; // tree particle count
    const turns = 10.5;

    treePts = [];
    for(let i=0;i<N;i++){
      const u = Math.pow(Math.random(), 0.65);
      const y = tree.topY + u*tree.height;

      const rBase = Math.pow(u, 1.05) * tree.baseRadius;
      const t = u * Math.PI*2*turns + rand(-0.9, 0.9);
      const rr = rBase * rand(0.70, 1.05);

      const x = Math.cos(t) * rr;
      const z = Math.sin(t) * rr;

      const tt = clamp((u - 0.10)/0.90, 0, 1);
      const cMid = mix(WHITE, WARM, tt);
      const cBot = mix(cMid, PINK, clamp((u-0.35)/0.65, 0, 1));
      const c = mix(cBot, HOT, clamp((u-0.65)/0.35, 0, 1));

      const size = rand(0.8, 1.8) + 2.2*(1-u);
      const tw = Math.random()*1000;

      treePts.push({x,y,z,u,size,c,tw});
    }
  }

  function buildHeart(){
    heartPts = [];
    const scale = 1.8;
    const count = 650;

    for(let i=0;i<count;i++){
      const t = (i/(count-1)) * Math.PI*2;
      const x = 16*Math.pow(Math.sin(t),3);
      const y = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
      heartPts.push({x:x*scale, y:-y*scale});
    }
    const fillN = 900;
    for(let i=0;i<fillN;i++){
      const a = Math.random()*Math.PI*2;
      const r = Math.sqrt(Math.random());
      const x = (16*Math.pow(Math.sin(a),3)) * scale * r;
      const y = -(13*Math.cos(a) - 5*Math.cos(2*a) - 2*Math.cos(3*a) - Math.cos(4*a)) * scale * r;
      heartPts.push({x, y});
    }
  }

  function buildRings(){
    ringPts = [];
    const rings = [
      {rad: Math.min(240, W*0.24), y: 180, thick: 18, n: 1200, phase: 0.0},
      {rad: Math.min(310, W*0.31), y: 206, thick: 22, n: 1400, phase: 0.6},
      {rad: Math.min(390, W*0.39), y: 238, thick: 26, n: 1600, phase: 1.2},
    ];

    for(const R of rings){
      for(let i=0;i<R.n;i++){
        const a = (i/R.n)*Math.PI*2;
        const ex = Math.cos(a) * R.rad;
        const ez = Math.sin(a) * R.rad * 0.55;
        const n = rand(-R.thick, R.thick);
        const x = ex + (ex/R.rad)*n;
        const z = ez + (ez/(R.rad*0.55))*n;
        const y = R.y + rand(-6, 6);
        ringPts.push({x, y, z, a, phase:R.phase, seed:Math.random()*10});
      }
    }
  }

  function buildCodeBackground(){
    bgCode = [];
    const lines = [
      "def main():",
      "    screen.fill(BLACK)",
      "    for obstacle in obstacles:",
      "        obstacle.draw()",
      "",
      "    player.draw()",
      "    for tank in enemy_tanks:",
      "        tank.draw()",
      "",
      "    for bullet in bullets:",
      "        bullet.draw()",
      "",
      "    score_text = font.render(...)",
      "    screen.blit(score_text, ...)",
    ];

    const x0 = Math.max(18, W*0.08);
    const y0 = Math.max(22, H*0.12);
    for(let i=0;i<lines.length;i++){
      bgCode.push({text: lines[i], x: x0, y: y0 + i*18});
    }
  }

  function buildAll(){
    buildSnow();
    buildTree();
    buildHeart();
    buildRings();
    buildCodeBackground();
  }

  // ---------- Draw ----------
  function drawBackground(time){
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, "#0a0f1b");
    g.addColorStop(1, "#04060c");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    ctx.save();
    ctx.globalAlpha = 0.10;
    ctx.fillStyle = "rgba(220,255,240,0.95)";
    ctx.font = "14px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace";
    for(const L of bgCode){
      ctx.fillText(L.text, L.x, L.y);
    }
    ctx.restore();

    const vg = ctx.createRadialGradient(W*0.5,H*0.45, Math.min(W,H)*0.1, W*0.5,H*0.45, Math.min(W,H)*0.78);
    vg.addColorStop(0, "rgba(0,0,0,0)");
    vg.addColorStop(1, "rgba(0,0,0,0.60)");
    ctx.fillStyle = vg;
    ctx.fillRect(0,0,W,H);
  }

  function drawSnow(){
    ctx.save();
    for(const s of snow){
      s.x += s.vx;
      s.y += s.vy;
      if(s.y > H + 8){ s.y = -10; s.x = Math.random()*W; }
      if(s.x < -10) s.x = W + 10;
      if(s.x > W + 10) s.x = -10;

      ctx.globalAlpha = s.a;
      const gx = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r*2.4);
      gx.addColorStop(0, "rgba(255,255,255,0.95)");
      gx.addColorStop(1, "rgba(255,255,255,0)");
      ctx.fillStyle = gx;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r*2.4, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  }

  function drawGround(){
    // ‚úÖ Á´ñÂ±èËÆ©Âú∞Èù¢Âç†ÊØîÂ∞è‰∏ÄÁÇπÔºàÊ†ëÁúãËµ∑Êù•Êõ¥Â§ßÔºâ
    const portrait = H > W * 1.15;
    const y0 = H * (portrait ? 0.78 : 0.72);

    ctx.save();
    const grd = ctx.createLinearGradient(0, y0, 0, H);
    grd.addColorStop(0, "rgba(236,246,255,0.95)");
    grd.addColorStop(1, "rgba(213,232,255,0.98)");
    ctx.fillStyle = grd;
    ctx.fillRect(0, y0, W, H-y0);

    const edge = ctx.createLinearGradient(0, y0-70, 0, y0+10);
    edge.addColorStop(0, "rgba(255,255,255,0)");
    edge.addColorStop(1, "rgba(255,255,255,0.35)");
    ctx.fillStyle = edge;
    ctx.fillRect(0, y0-70, W, 80);
    ctx.restore();
  }

  function drawGreeting(){
    ctx.save();
    ctx.fillStyle = "rgba(255,255,255,0.92)";
    ctx.shadowColor = "rgba(0,0,0,0.55)";
    ctx.shadowBlur = 14;
    ctx.font = "italic 44px 'Times New Roman', Georgia, serif";
    ctx.fillText("Merry Christmas.", Math.max(20, W*0.12), H*0.44);
    ctx.restore();
  }

  function drawTree(time, speed){
    const cx = W/2, cy = H/2 + 34;
    const rot = time * 0.0010 * speed;

    const pts = treePts.map(p=>{
      const rz = rotY(p.x, p.z, rot);
      const pr = project3D(rz.x, p.y, rz.z);
      return { ...p, rz:rz.z, px:pr.x, py:pr.y, ps:pr.s };
    }).sort((a,b)=>a.rz - b.rz);

    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    for(const p of pts){
      const x = cx + p.px;
      const y = cy + p.py;

      const tw = 0.55 + 0.45*Math.sin(time*0.004 + p.tw);
      const r = (p.size * p.ps) * (0.85 + 0.35*tw);
      const a = clamp(0.18 + 0.55*(1-p.u) + 0.20*tw, 0.05, 0.95);

      glowDot(x,y, r*3.0, rgba(p.c, 0.35), a);
      ctx.globalAlpha = a;
      ctx.fillStyle = rgba(p.c, 0.92);
      ctx.beginPath();
      ctx.arc(x,y, r*0.55, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    const top = project3D(0, tree.topY - 58, 0);
    const hx = cx + top.x;
    const hy = cy + top.y;

    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    for(let i=0;i<heartPts.length;i++){
      const p = heartPts[i];
      const jitter = 0.30 + 0.70*Math.sin(time*0.004 + i*0.02);
      const x = hx + p.x*0.9;
      const y = hy + p.y*0.9;
      const rr = 1.4 + 1.1*jitter;
      glowDot(x,y, rr*3.2, "rgba(255,90,140,0.55)", 0.9);
      ctx.globalAlpha = 0.85;
      ctx.fillStyle = "rgba(255,230,240,0.95)";
      ctx.beginPath();
      ctx.arc(x,y, rr*0.55, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    const base = project3D(0, tree.topY + tree.height*0.95, 0);
    glowDot(cx + base.x, cy + base.y + 10, Math.min(W,H)*0.22, "rgba(255,90,140,0.18)", 1);
    ctx.restore();
  }

  function drawRings(time, speed){
    const cx = W/2, cy = H/2 + 54;
    const rot = time * 0.00055 * speed;

    const pts = ringPts.map(p=>{
      const phase = p.phase + time*0.0009*speed;
      const wobble = 0.12*Math.sin(p.a*6 + phase*2 + p.seed);
      const rz = rotY(p.x, p.z, rot + wobble);
      const pr = project3D(rz.x, p.y, rz.z);
      return { ...p, rz:rz.z, px:pr.x, py:pr.y, ps:pr.s, wobble };
    }).sort((a,b)=>a.rz - b.rz);

    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    for(const p of pts){
      const x = cx + p.px;
      const y = cy + p.py;

      const tw = 0.45 + 0.55*Math.sin(time*0.005 + p.seed*3);
      const rr = (1.1 + 1.8*tw) * p.ps;
      const a = 0.20 + 0.55*tw;

      const tint = (Math.sin(p.a*3 + time*0.0012) > 0.6) ? "rgba(255,120,170,0.35)" : "rgba(255,255,255,0.35)";
      glowDot(x,y, rr*4.2, tint, a);
      ctx.globalAlpha = 0.9;
      ctx.fillStyle = "rgba(255,255,255,0.92)";
      ctx.beginPath();
      ctx.arc(x,y, rr*0.55, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  }

  // ---------- App state ----------
  let opened = false;
  let time = 0;
  let speed = 1;

  function frame(){
    if(!opened) return;
    time += 16.6667;

    drawBackground(time);
    drawSnow();
    drawGround();
    drawRings(time, speed);
    drawTree(time, speed);
    drawGreeting();

    requestAnimationFrame(frame);
  }

  function openCard(){
    if(opened) return;
    opened = true;
    document.body.classList.add("open");
    requestAnimationFrame(frame);
  }

  document.getElementById("openBtn").addEventListener("click", openCard);

  window.addEventListener("click", (e)=>{
    if(!opened) return;
    if(e.target && (e.target.id==="openBtn" || e.target.closest?.("#openBtn"))) return;
    speed = (speed === 1) ? 1.9 : 1;
  });

  // init
  resize();
})();
</script>
</body>
</html>

