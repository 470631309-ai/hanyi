<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Christmas Card</title>
  <style>
    :root{
      --bg1:#07101f;
      --bg2:#0b1220;
      --card:#f2efea;
      --ink:#111;
      --link:#1f3bb3;
      --shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Microsoft YaHei", Arial, sans-serif;}
    body{
      overflow:hidden;
      background: radial-gradient(1200px 600px at 30% 35%, rgba(255,190,120,.35), transparent 55%),
                  radial-gradient(900px 600px at 70% 60%, rgba(40,180,255,.18), transparent 55%),
                  linear-gradient(180deg, var(--bg2), var(--bg1));
      color:#fff;
    }
    .bg-blur{
      position:fixed; inset:-40px;
      background:
        radial-gradient(900px 600px at 15% 45%, rgba(255,160,90,.40), transparent 60%),
        radial-gradient(900px 600px at 85% 35%, rgba(80,220,255,.22), transparent 60%),
        linear-gradient(180deg, #1a2234, #060b14);
      filter: blur(14px) saturate(1.2);
      transform: scale(1.08);
      opacity:.75;
      pointer-events:none;
    }

    .cover{
      position:fixed; inset:0;
      display:grid;
      place-items:center;
      padding:24px;
      z-index:10;
      transition: opacity .45s ease, transform .55s ease;
    }
    .card{
      width:min(760px, 92vw);
      height:min(380px, 46vh);
      background: var(--card);
      border-radius: 18px;
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1.05fr 1fr;
      gap:22px;
      padding:34px 34px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(280px 220px at 20% 35%, rgba(255,90,90,.12), transparent 60%),
                  radial-gradient(320px 260px at 80% 70%, rgba(80,160,255,.14), transparent 62%);
      pointer-events:none;
    }

    .mc{
      color:var(--ink);
      font-weight:900;
      font-size:54px;
      line-height: .9;
      letter-spacing:.5px;
      font-family: ui-rounded, "Comic Sans MS", "Bradley Hand", "Segoe Script", cursive;
      transform: rotate(-6deg);
      margin-top:6px;
      user-select:none;
    }
    .mc small{
      display:block;
      font-size:18px;
      font-weight:700;
      margin-top:10px;
      opacity:.7;
      transform: rotate(6deg);
      font-family: system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
    }
    .right{
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:12px;
      color:#222;
      padding-left:8px;
    }
    .quote{ font-size:20px; font-weight:700; }
    .sub{ font-size:16px; opacity:.85; line-height:1.7; }

    .click{
      margin-top:8px;
      font-size:18px;
      font-weight:800;
      color:var(--link);
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      width:max-content;
      padding:10px 14px;
      border-radius:12px;
      background: rgba(31,59,179,.08);
      transition: transform .15s ease, background .2s ease;
    }
    .click:hover{ transform: translateY(-1px); background: rgba(31,59,179,.12); }
    .click:active{ transform: translateY(1px); }

    body.open .cover{
      opacity:0;
      transform: translateY(-8px) scale(.98);
      pointer-events:none;
    }

    #scene{
      position:fixed; inset:0;
      display:block;
      opacity:0;
      transition: opacity .55s ease;
    }
    body.open #scene{ opacity:1; }

    .hint{
      position:fixed;
      top:16px; left:50%;
      transform:translateX(-50%);
      font-size:14px;
      opacity:.78;
      z-index:2;
      pointer-events:none;
      text-shadow: 0 6px 18px rgba(0,0,0,.35);
      user-select:none;
    }
    .footer{
      position:fixed;
      bottom:18px; left:50%;
      transform:translateX(-50%);
      font-size:16px;
      font-weight:700;
      opacity:.9;
      z-index:2;
      pointer-events:none;
      text-shadow: 0 6px 18px rgba(0,0,0,.35);
      user-select:none;
    }
  </style>
</head>

<body>
  <div class="bg-blur"></div>

  <div class="cover">
    <div class="card">
      <div>
        <div class="mc">
          merry<br/>christmas
          <small>üéÑ ‚ú®</small>
        </div>
      </div>

      <div class="right">
        <div class="quote" id="toText">‚ÄúÊÑø‚ÄùÂπ≥ÂÆâÂñú‰πê</div>
        <div class="sub" id="subText">‰∏á‰∫ãÈ°∫ÈÅÇ</div>
        <div class="click" id="openBtn">
          <span id="clickText">ÁÇπÂáªÊúâÊÉäÂñú</span>
          <span aria-hidden="true">‚ñ∂</span>
        </div>
      </div>
    </div>
  </div>

  <canvas id="scene"></canvas>
  <div class="hint">ÊâìÂºÄÂêéÔºöÁÇπÂáª‰ªªÊÑèÂ§ÑÂàáÊç¢ÊóãËΩ¨ÈÄüÂ∫¶</div>
  <div class="footer">üéÅ Merry Christmas & Happy New Year ‚ú®</div>

<script>
(() => {
  const canvas = document.getElementById("scene");
  const ctx = canvas.getContext("2d");

  let W=0, H=0, DPR=1;
  function resize(){
    DPR = Math.min(2, window.devicePixelRatio || 1);
    W = Math.floor(window.innerWidth);
    H = Math.floor(window.innerHeight);
    canvas.width = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    canvas.style.width = W + "px";
    canvas.style.height = H + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  window.addEventListener("resize", resize);
  resize();

  const tree = {
    height: Math.min(560, H*0.78),
    baseRadius: Math.min(240, W*0.23),
    topY: -Math.min(250, H*0.24),
  };

  const cam = { fov: 520, zoff: 520 };

  function project3D(x, y, z){
    const zz = z + cam.zoff;
    const s = cam.fov / (cam.fov + zz);
    return { x: x*s, y: y*s, s };
  }
  function rotY(x, z, a){
    const ca = Math.cos(a), sa = Math.sin(a);
    return { x: x*ca - z*sa, z: x*sa + z*ca };
  }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function glowDot(x,y,r,color,alpha=1){
    ctx.save();
    ctx.globalAlpha = alpha;
    const g = ctx.createRadialGradient(x,y,0,x,y,r);
    g.addColorStop(0, color);
    g.addColorStop(1, "rgba(255,255,255,0)");
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  // ----- Snow particles -----
  const snow = [];
  function randBetween(a,b){ return a + Math.random()*(b-a); }
  function buildSnow(){
    snow.length = 0;
    const n = Math.floor(Math.min(220, 120 + (W*H)/22000));
    for(let i=0;i<n;i++){
      snow.push({
        x: Math.random()*W,
        y: Math.random()*H,
        vy: randBetween(0.35, 1.6),
        vx: randBetween(-0.25, 0.25),
        r: randBetween(0.8, 3.2),
        a: randBetween(0.35, 0.95)
      });
    }
  }
  buildSnow();

  // ----- Star field -----
  const stars = [];
  function buildStars(){
    stars.length = 0;
    const n = 120;
    for(let i=0;i<n;i++){
      stars.push({
        x: Math.random()*W,
        y: Math.random()*H*0.62,
        r: randBetween(0.8, 2.2),
        a: randBetween(0.35, 0.9),
        tw: Math.random()*1000
      });
    }
  }
  buildStars();

  // ----- Foliage points (green pine) -----
  const foliage = [];
  function buildFoliage(){
    foliage.length = 0;
    const rings = 185;
    const perRing = 55;
    for(let i=0;i<rings;i++){
      const u = i/(rings-1);
      const y = tree.topY + u*tree.height;
      const radius = Math.pow(u, 0.92) * tree.baseRadius * (0.98 - 0.08*Math.sin(u*6.2));
      for(let k=0;k<perRing;k++){
        const t = (k/perRing)*Math.PI*2;
        const jitter = (Math.random()*2-1) * (2 + 14*u);
        const x = Math.cos(t) * (radius + jitter);
        const z = Math.sin(t) * (radius + jitter);
        const shade = 0.55 + 0.45*Math.cos(t*0.9);
        foliage.push({x,y,z,shade,u});
      }
    }
    // trunk (subtle)
    const trunkN = 700;
    for(let i=0;i<trunkN;i++){
      const u = Math.random();
      const y = tree.topY + tree.height*(0.65 + u*0.35);
      const r = tree.baseRadius*0.05 + u*tree.baseRadius*0.03;
      const t = Math.random()*Math.PI*2;
      foliage.push({x:Math.cos(t)*r, y, z:Math.sin(t)*r, shade:0.3, u:1.0, trunk:true});
    }
  }
  buildFoliage();

  // ----- Ornaments -----
  const ornaments = [];
  const ornamentColors = ["#ffd166","#ff4d6d","#4cc9f0","#b7ff6a","#c77dff","#ffffff"];
  function buildOrnaments(){
    ornaments.length = 0;
    const n = 52;
    for(let i=0;i<n;i++){
      const u = randBetween(0.18, 0.98);
      const y = tree.topY + u*tree.height;
      const r = Math.pow(u, 0.92) * tree.baseRadius;
      const t = Math.random()*Math.PI*2;
      ornaments.push({
        x: Math.cos(t)*r,
        y,
        z: Math.sin(t)*r,
        radius: randBetween(4, 10) + 7*u,
        color: ornamentColors[Math.floor(Math.random()*ornamentColors.length)],
        tw: Math.random()*1000
      });
    }
  }
  buildOrnaments();

  // ----- String lights (random) -----
  const lights = [];
  const lightColors = ["#ffd166","#ffe8a3","#ff6b6b","#4dabf7","#69db7c","#c77dff"];
  function buildLights(){
    lights.length = 0;
    const n = 260;
    for(let i=0;i<n;i++){
      const u = randBetween(0.08, 0.99);
      const y = tree.topY + u*tree.height;
      const r = Math.pow(u, 0.92) * tree.baseRadius * randBetween(0.80, 1.02);
      const t = Math.random()*Math.PI*2;
      lights.push({
        x: Math.cos(t)*r,
        y,
        z: Math.sin(t)*r,
        color: lightColors[Math.floor(Math.random()*lightColors.length)],
        tw: Math.random()*1000,
        size: randBetween(1.6, 3.6) + 2.2*u
      });
    }
  }
  buildLights();

  // ----- Golden spiral ribbon (tighter + less blur) -----
  const spiral = [];
  function buildSpiral(){
    spiral.length = 0;
    const count = 720;
    const turn = 7.2;
    for(let i=0;i<count;i++){
      const u = i/(count-1);
      const y = tree.topY + u*tree.height;
      const r = Math.pow(u, 0.92) * tree.baseRadius * 0.92;
      const t = u * Math.PI*2*turn;
      spiral.push({u,y,r,t,seed:Math.random()*10});
    }
  }
  buildSpiral();

  // ----- Animation state -----
  let opened = false;
  let time = 0;
  let speed = 1;

  function drawBackground(){
    // sky gradient
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, "#07101f");
    g.addColorStop(1, "#04070e");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    // vignette
    const vg = ctx.createRadialGradient(W*0.5,H*0.45, Math.min(W,H)*0.1, W*0.5,H*0.45, Math.min(W,H)*0.75);
    vg.addColorStop(0, "rgba(0,0,0,0)");
    vg.addColorStop(1, "rgba(0,0,0,0.55)");
    ctx.fillStyle = vg;
    ctx.fillRect(0,0,W,H);

    // twinkling stars
    ctx.save();
    for(const s of stars){
      const tw = 0.55 + 0.45*Math.sin(time*0.002 + s.tw);
      ctx.globalAlpha = s.a * tw;
      ctx.fillStyle = "#ffffff";
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  }

  function drawSnow(){
    ctx.save();
    for(const s of snow){
      s.x += s.vx;
      s.y += s.vy;
      if(s.y > H + 8){ s.y = -10; s.x = Math.random()*W; }
      if(s.x < -10) s.x = W + 10;
      if(s.x > W + 10) s.x = -10;

      ctx.globalAlpha = s.a;
      const gx = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r*2.2);
      gx.addColorStop(0, "rgba(255,255,255,0.95)");
      gx.addColorStop(1, "rgba(255,255,255,0)");
      ctx.fillStyle = gx;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r*2.2, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  }

  function drawGround(){
    // soft snow bank (curved) + gradient
    const y0 = H*0.74;
    ctx.save();
    const grd = ctx.createLinearGradient(0, y0, 0, H);
    grd.addColorStop(0, "rgba(236,246,255,0.95)");
    grd.addColorStop(1, "rgba(213,232,255,0.98)");
    ctx.fillStyle = grd;

    ctx.beginPath();
    ctx.moveTo(0, H);
    ctx.lineTo(0, y0);
    ctx.quadraticCurveTo(W*0.35, y0-40, W*0.55, y0-16);
    ctx.quadraticCurveTo(W*0.78, y0+10, W, y0-22);
    ctx.lineTo(W, H);
    ctx.closePath();
    ctx.fill();

    // subtle highlight
    const hg = ctx.createRadialGradient(W*0.5, y0-10, 10, W*0.5, y0-10, W*0.6);
    hg.addColorStop(0, "rgba(255,255,255,0.35)");
    hg.addColorStop(1, "rgba(255,255,255,0)");
    ctx.fillStyle = hg;
    ctx.fillRect(0, y0-80, W, 180);

    ctx.restore();
  }

  function drawTree(){
    const cx = W/2, cy = H/2 + 40;
    const rot = time * 0.0011 * speed;

    // foliage depth sort
    const pts = foliage.map(p=>{
      const rz = rotY(p.x, p.z, rot);
      const pr = project3D(rz.x, p.y, rz.z);
      return { ...p, rz:rz.z, px:pr.x, py:pr.y, ps:pr.s };
    }).sort((a,b)=>a.rz - b.rz);

    // foliage (green pine)
    ctx.save();
    for(const p of pts){
      const x = cx + p.px;
      const y = cy + p.py;

      const depth = clamp((p.rz + 220)/520, 0, 1); // 0 near, 1 far
      const flick = 0.06*Math.sin(time*0.003 + p.u*11 + p.shade*7);
      const light = clamp(p.shade + flick, 0, 1);

      let r,g,b,a;
      if(p.trunk){
        r = 92; g = 70; b = 48; a = 0.55;
      }else{
        // pine palette
        r = Math.floor(28 + 22*light);
        g = Math.floor(95 + 95*light);
        b = Math.floor(48 + 30*light);
        a = 0.40 + 0.42*(1 - p.u) + 0.14*(1-depth);
      }
      ctx.globalAlpha = a;
      const size = (0.9 + 2.1*(1-p.u)) * p.ps;
      ctx.fillStyle = `rgb(${r},${g},${b})`;
      ctx.fillRect(x, y, size, size);
    }
    ctx.restore();

    // star topper
    ctx.save();
    const top = project3D(0, tree.topY - 20, 0);
    const sx = cx + top.x, sy = cy + top.y;
    ctx.globalCompositeOperation = "lighter";
    glowDot(sx, sy, 46, "rgba(255,209,102,.55)", 1);
    glowDot(sx, sy, 18, "rgba(255,240,200,.9)", 1);
    ctx.fillStyle = "rgba(255,209,102,0.95)";
    ctx.beginPath();
    const R=14, r=6;
    for(let i=0;i<10;i++){
      const ang = -Math.PI/2 + i*(Math.PI/5);
      const rad = (i%2===0)?R:r;
      ctx.lineTo(sx + Math.cos(ang)*rad, sy + Math.sin(ang)*rad);
    }
    ctx.closePath();
    ctx.fill();
    ctx.restore();

    // string lights (additive)
    const ls = lights.map(o=>{
      const rz = rotY(o.x, o.z, rot*1.02);
      const pr = project3D(rz.x, o.y, rz.z);
      return {...o, rz:rz.z, px:pr.x, py:pr.y, ps:pr.s};
    }).sort((a,b)=>a.rz - b.rz);

    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    for(const l of ls){
      const x = cx + l.px;
      const y = cy + l.py;
      const tw = 0.40 + 0.60*Math.sin(time*0.004 + l.tw);
      const rr = l.size * l.ps;
      glowDot(x,y, rr*5.0, l.color.replace("#","rgba(").includes("rgba(") ? l.color : l.color, 0.18 + 0.25*tw);
      ctx.globalAlpha = 0.85;
      ctx.fillStyle = "rgba(255,255,255,0.92)";
      ctx.beginPath();
      ctx.arc(x,y, rr*0.55, 0, Math.PI*2);
      ctx.fill();
      glowDot(x,y, rr*2.0, l.color, 0.20 + 0.30*tw);
    }
    ctx.restore();

    // ornaments
    const balls = ornaments.map(o=>{
      const rz = rotY(o.x, o.z, rot*1.03);
      const pr = project3D(rz.x, o.y, rz.z);
      return {...o, rz:rz.z, px:pr.x, py:pr.y, ps:pr.s};
    }).sort((a,b)=>a.rz - b.rz);

    ctx.save();
    for(const b of balls){
      const x = cx + b.px;
      const y = cy + b.py;
      const rr = b.radius * b.ps * 1.15;

      const g = ctx.createRadialGradient(x-rr*0.35, y-rr*0.35, rr*0.2, x, y, rr);
      g.addColorStop(0, "rgba(255,255,255,.9)");
      g.addColorStop(0.18, b.color);
      g.addColorStop(1, "rgba(0,0,0,.25)");
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(x,y,rr,0,Math.PI*2);
      ctx.fill();

      const tw = 0.35 + 0.35*Math.sin(time*0.005 + b.tw);
      ctx.globalCompositeOperation = "lighter";
      glowDot(x,y, rr*2.6, b.color, 0.16 + 0.20*tw);
      ctx.globalCompositeOperation = "source-over";
    }
    ctx.restore();

    // golden spiral ribbon (tighter, less blur)
    const sp = spiral.map(s=>{
      const tt = s.t + time*0.0034*speed;
      const x = Math.cos(tt)*s.r;
      const z = Math.sin(tt)*s.r;
      const rz = rotY(x, z, rot*0.92);
      const pr = project3D(rz.x, s.y, rz.z);
      return { ...s, rz:rz.z, px:pr.x, py:pr.y, ps:pr.s, tt };
    }).sort((a,b)=>a.rz - b.rz);

    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    for(const p of sp){
      const x = cx + p.px;
      const y = cy + p.py;
      const pulse = 0.40 + 0.60*Math.sin(time*0.006 + p.seed);
      const r = (1.6 + 3.2*pulse) * p.ps;
      // smaller glow than previous version to reduce blur
      glowDot(x,y, r*3.4, "rgba(255,209,102,.40)", 1);
      ctx.globalAlpha = 0.9;
      ctx.fillStyle = "rgba(255,238,190,.95)";
      ctx.beginPath();
      ctx.arc(x,y, r, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  }

  function frame(){
    if(!opened) return;
    time += 16.6667;

    drawBackground();
    drawSnow();
    drawGround();
    drawTree();

    requestAnimationFrame(frame);
  }

  function openCard(){
    if(opened) return;
    opened = true;
    document.body.classList.add("open");
    buildSnow();
    buildStars();
    requestAnimationFrame(frame);
  }

  document.getElementById("openBtn").addEventListener("click", openCard);

  // toggle speed after opened
  window.addEventListener("click", (e)=>{
    if(!opened) return;
    if(e.target && (e.target.id==="openBtn" || e.target.closest?.("#openBtn"))) return;
    speed = (speed === 1) ? 1.8 : 1;
  });

})();
</script>
</body>
</html>
