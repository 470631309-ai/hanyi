<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Christmas Card</title>
  <style>
    :root{
      --card:#f2efea;
      --ink:#111;
      --link:#1f3bb3;
      --shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Microsoft YaHei",Arial,sans-serif;}
    body{
      overflow:hidden;
      background: linear-gradient(180deg, #0b1220, #050810);
      color:#fff;
      -webkit-text-size-adjust:100%;
    }

    .bg-blur{
      position:fixed; inset:-40px;
      background:
        radial-gradient(900px 600px at 20% 35%, rgba(255,120,160,.18), transparent 60%),
        radial-gradient(900px 600px at 78% 60%, rgba(140,180,255,.12), transparent 62%),
        linear-gradient(180deg, #151c2b, #060914);
      filter: blur(14px) saturate(1.1);
      transform: scale(1.08);
      opacity:.75;
      pointer-events:none;
    }

    .cover{
      position:fixed; inset:0;
      display:grid; place-items:center;
      padding:24px;
      padding-top: calc(24px + env(safe-area-inset-top));
      padding-bottom: calc(24px + env(safe-area-inset-bottom));
      z-index:10;
      transition: opacity .45s ease, transform .55s ease;
    }
    .card{
      width:min(760px, 92vw);
      height:min(380px, 46vh);
      background: var(--card);
      border-radius: 18px;
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1.05fr 1fr;
      gap:22px;
      padding:34px 34px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(280px 220px at 20% 35%, rgba(255,90,90,.12), transparent 60%),
                  radial-gradient(320px 260px at 80% 70%, rgba(80,160,255,.14), transparent 62%);
      pointer-events:none;
    }

    .mc{
      color:var(--ink);
      font-weight:900;
      font-size: clamp(34px, 10.5vw, 54px);
      line-height: .9;
      letter-spacing:.5px;
      font-family: ui-rounded, "Comic Sans MS", "Bradley Hand", "Segoe Script", cursive;
      transform: rotate(-6deg);
      margin-top:6px;
      user-select:none;
    }
    .mc small{
      display:block;
      font-size: clamp(14px, 4.2vw, 18px);
      font-weight:700;
      margin-top:10px;
      opacity:.7;
      transform: rotate(6deg);
      font-family: system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
    }
    .right{
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:12px;
      color:#222;
      padding-left:8px;
      min-width:0;
    }
    .quote{ font-size: clamp(16px, 4.8vw, 20px); font-weight:700; }
    .sub{ font-size: clamp(14px, 4.2vw, 16px); opacity:.85; line-height:1.7; }

    .click{
      margin-top:8px;
      font-size: clamp(16px, 4.5vw, 18px);
      font-weight:800;
      color:var(--link);
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      width:max-content;
      padding:10px 14px;
      border-radius:12px;
      background: rgba(31,59,179,.08);
      transition: transform .15s ease, background .2s ease;
    }
    .click:hover{ transform: translateY(-1px); background: rgba(31,59,179,.12); }
    .click:active{ transform: translateY(1px); }

    body.open .cover{
      opacity:0;
      transform: translateY(-8px) scale(.98);
      pointer-events:none;
    }

    #scene{
      position:fixed; inset:0;
      display:block;
      opacity:0;
      transition: opacity .55s ease;
    }
    body.open #scene{ opacity:1; }

    .hint{
      position:fixed;
      top: calc(16px + env(safe-area-inset-top));
      left:50%;
      transform:translateX(-50%);
      font-size:14px;
      opacity:.78;
      z-index:2;
      pointer-events:none;
      text-shadow: 0 6px 18px rgba(0,0,0,.35);
      user-select:none;
      padding:0 12px;
      max-width:92vw;
      text-align:center;
    }
    .footer{
      position:fixed;
      bottom: calc(18px + env(safe-area-inset-bottom));
      left:50%;
      transform:translateX(-50%);
      font-size:16px;
      font-weight:700;
      opacity:.9;
      z-index:2;
      pointer-events:none;
      text-shadow: 0 6px 18px rgba(0,0,0,.35);
      user-select:none;
      padding:0 12px;
      max-width:92vw;
      text-align:center;
    }

    /* å°å±å°é¢ä¸è¢«åˆ‡ï¼šå•åˆ— */
    @media (max-width: 520px){
      .card{
        grid-template-columns: 1fr;
        height:auto;
        padding:22px;
        gap:14px;
      }
      .right{ padding-left:0; }
      .click{ width:100%; justify-content:center; }
    }
  </style>
</head>

<body>
  <div class="bg-blur"></div>

  <div class="cover">
    <div class="card">
      <div>
        <div class="mc">
          merry<br/>christmas
          <small>ğŸ„ âœ¨</small>
        </div>
      </div>

      <div class="right">
        <div class="quote" id="toText">â€œæ„¿â€å¹³å®‰å–œä¹</div>
        <div class="sub" id="subText">ä¸‡äº‹é¡ºé‚</div>
        <div class="click" id="openBtn">
          <span id="clickText">ç‚¹å‡»æœ‰æƒŠå–œ</span>
          <span aria-hidden="true">â–¶</span>
        </div>
      </div>
    </div>
  </div>

  <canvas id="scene"></canvas>
  <div class="hint">æ‰“å¼€åï¼šç‚¹å‡»ä»»æ„å¤„åˆ‡æ¢æ—‹è½¬é€Ÿåº¦</div>
  <div class="footer">ğŸ Merry Christmas & Happy New Year âœ¨</div>

<script>
(() => {
  const canvas = document.getElementById("scene");
  const ctx = canvas.getContext("2d");

  let W=0, H=0, DPR=1;

  // --- helpers
  const rand=(a,b)=>a+Math.random()*(b-a);
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const lerp=(a,b,t)=>a+(b-a)*t;

  function resize(){
    DPR = Math.min(2, window.devicePixelRatio || 1);
    const vw = window.visualViewport?.width  || window.innerWidth;
    const vh = window.visualViewport?.height || window.innerHeight;
    W = Math.floor(vw);
    H = Math.floor(vh);

    canvas.width  = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    canvas.style.width = W + "px";
    canvas.style.height = H + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
    buildAll();
  }
  window.addEventListener("resize", resize);
  window.visualViewport?.addEventListener("resize", resize);

  // --- 3D-ish
  const cam = { fov: 520, zoff: 620 };
  function project3D(x,y,z){
    const zz = z + cam.zoff;
    const s = cam.fov / (cam.fov + zz);
    return { x: x*s, y: y*s, s };
  }
  function rotY(x,z,a){
    const ca=Math.cos(a), sa=Math.sin(a);
    return { x: x*ca - z*sa, z: x*sa + z*ca };
  }

  function glowDot(x,y,r,color,a=1){
    ctx.save();
    ctx.globalAlpha = a;
    const g = ctx.createRadialGradient(x,y,0,x,y,r);
    g.addColorStop(0, color);
    g.addColorStop(1, "rgba(255,255,255,0)");
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  // --- scene data
  let snow=[], treePts=[], garlandPts=[], ornaments=[], starGlow=[];
  const palette = ["#ff3b30","#ffcc00","#34c759","#5ac8fa","#5856d6","#ff2d55","#ffffff"];

  const tree = { height: 0, baseRadius: 0, topY: 0 };

  function buildSnow(){
    const n = Math.floor(Math.min(260, 150 + (W*H)/22000));
    snow = Array.from({length:n}, ()=>({
      x: Math.random()*W,
      y: Math.random()*H,
      vy: rand(0.5, 2.0),
      vx: rand(-0.25, 0.25),
      r:  rand(0.9, 3.8),
      a:  rand(0.25, 0.95),
    }));
  }

  // âœ… è¿™æ£µæ ‘ï¼šç»¿è‰²æ ‘ä½“ + å½©ç¯ç‚¹ï¼ˆæ›´æ¥è¿‘ä½ æœ€æ—©é‚£ç‰ˆï¼‰
  function buildTree(){
    const portrait = H > W;
    tree.height = Math.min(640, H*(portrait ? 0.92 : 0.82));
    tree.baseRadius = Math.min(260, W*(portrait ? 0.30 : 0.24));
    tree.topY = -Math.min(300, H*(portrait ? 0.30 : 0.25));

    const N = 6200;
    const turns = 10.6;

    treePts = [];
    for(let i=0;i<N;i++){
      const u = Math.pow(Math.random(), 0.62);
      const y = tree.topY + u*tree.height;

      const rBase = Math.pow(u, 1.08) * tree.baseRadius;
      const t = u * Math.PI*2*turns + rand(-0.9,0.9);
      const rr = rBase * rand(0.72, 1.06);

      const x = Math.cos(t) * rr;
      const z = Math.sin(t) * rr;

      // ç»¿è‰²æ ‘ä½“ + ä¸€äº›å½©ç¯
      const isLight = Math.random() < (0.16 + 0.20*u); // åº•éƒ¨ç¯æ›´å¤š
      const color = isLight ? palette[Math.floor(Math.random()*palette.length)] : "#2ed36a";

      const size = isLight ? rand(1.0, 2.3) : rand(0.7, 1.6);
      const tw = Math.random()*1000;

      treePts.push({x,y,z,u,size,color,isLight,tw});
    }
  }

  // âœ… èºæ—‹ç¯å¸¦ï¼ˆä½ æˆªå›¾é‚£æ¡äº®äº®çš„ç»•æ ‘ä¸€åœˆï¼‰
  function buildGarland(){
    garlandPts = [];
    const turns = 8.2; // ç¯å¸¦åœˆæ•°
    const steps = 2200;

    for(let i=0;i<steps;i++){
      const t = (i/(steps-1)) * Math.PI*2*turns;
      const u = t / (Math.PI*2*turns);
      const y = tree.topY + u*tree.height;

      const rBase = Math.pow(u, 1.08) * tree.baseRadius;
      const rr = rBase * 0.95;

      const x = Math.cos(t) * rr;
      const z = Math.sin(t) * rr;

      garlandPts.push({x,y,z,u,tw:Math.random()*1000});
    }
  }

  // âœ… å½©çƒï¼ˆåº•éƒ¨å¤šä¸€ç‚¹ï¼Œè·Ÿä½ æˆªå›¾å¾ˆåƒï¼‰
  function buildOrnaments(){
    ornaments = [];
    const M = 70;
    for(let i=0;i<M;i++){
      const u = Math.pow(rand(0.55, 1.0), 0.78);
      const y = tree.topY + u*tree.height + rand(-10, 10);
      const rBase = Math.pow(u, 1.08) * tree.baseRadius;
      const a = rand(0, Math.PI*2);
      const rr = rBase * rand(0.55, 0.95);
      const x = Math.cos(a) * rr;
      const z = Math.sin(a) * rr;
      const color = palette[Math.floor(Math.random()* (palette.length-1))]; // å°‘ç”¨çº¯ç™½
      const rad = lerp(8, 15, u) * rand(0.85,1.15);
      ornaments.push({x,y,z,u,color,rad,seed:Math.random()*10});
    }
  }

  // âœ… é¡¶éƒ¨æ˜Ÿæ˜Ÿ
  function buildStar(){
    starGlow = [];
    const topY = tree.topY - 34;
    for(let i=0;i<160;i++){
      starGlow.push({
        x: rand(-14,14),
        y: topY + rand(-14,14),
        z: rand(-12,12),
        a: rand(0.3, 1.0),
        r: rand(6, 16),
      });
    }
  }

  function buildAll(){
    buildSnow();
    buildTree();
    buildGarland();
    buildOrnaments();
    buildStar();
  }

  function drawBackground(){
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, "#070b14");
    g.addColorStop(1, "#02030a");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    // vignette
    const vg = ctx.createRadialGradient(W*0.5,H*0.45, Math.min(W,H)*0.1, W*0.5,H*0.45, Math.min(W,H)*0.78);
    vg.addColorStop(0, "rgba(0,0,0,0)");
    vg.addColorStop(1, "rgba(0,0,0,0.62)");
    ctx.fillStyle = vg;
    ctx.fillRect(0,0,W,H);
  }

  function drawSnow(){
    ctx.save();
    for(const s of snow){
      s.x += s.vx;
      s.y += s.vy;
      if(s.y > H + 10){ s.y = -12; s.x = Math.random()*W; }
      if(s.x < -12) s.x = W + 12;
      if(s.x > W + 12) s.x = -12;

      ctx.globalAlpha = s.a;
      const gx = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r*3.0);
      gx.addColorStop(0, "rgba(255,255,255,0.95)");
      gx.addColorStop(1, "rgba(255,255,255,0)");
      ctx.fillStyle = gx;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r*3.0, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  }

  // âœ… åœ°é¢åšæˆå¼§å½¢é›ªå¡ï¼ˆæ›´åƒä½ æˆªå›¾ï¼‰
  function drawGround(){
    const y0 = H*0.70;
    ctx.save();
    const grd = ctx.createLinearGradient(0, y0, 0, H);
    grd.addColorStop(0, "rgba(230,244,255,0.95)");
    grd.addColorStop(1, "rgba(205,228,255,0.98)");
    ctx.fillStyle = grd;

    ctx.beginPath();
    ctx.moveTo(0, H);
    ctx.lineTo(0, y0 + 28);
    ctx.quadraticCurveTo(W*0.30, y0 - 18, W*0.55, y0 + 24);
    ctx.quadraticCurveTo(W*0.78, y0 + 52, W, y0 + 14);
    ctx.lineTo(W, H);
    ctx.closePath();
    ctx.fill();

    // é¡¶éƒ¨æŸ”è¾¹
    const edge = ctx.createLinearGradient(0, y0-90, 0, y0+30);
    edge.addColorStop(0, "rgba(255,255,255,0)");
    edge.addColorStop(1, "rgba(255,255,255,0.38)");
    ctx.fillStyle = edge;
    ctx.fillRect(0, y0-90, W, 140);
    ctx.restore();
  }

  function drawGreeting(){
    ctx.save();
    ctx.fillStyle = "rgba(255,255,255,0.90)";
    ctx.shadowColor = "rgba(0,0,0,0.55)";
    ctx.shadowBlur = 14;
    ctx.font = "italic 44px 'Times New Roman', Georgia, serif";
    ctx.fillText("Merry Christmas.", Math.max(20, W*0.10), H*0.42);
    ctx.restore();
  }

  function drawStar(cx, cy, rot){
    // ç®€å•äº”è§’æ˜Ÿ
    const r1 = 18, r2 = 8;
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(rot);
    ctx.beginPath();
    for(let i=0;i<10;i++){
      const a = i * Math.PI/5;
      const r = (i%2===0) ? r1 : r2;
      ctx.lineTo(Math.cos(a)*r, Math.sin(a)*r);
    }
    ctx.closePath();
    ctx.fillStyle = "rgba(255,245,210,0.98)";
    ctx.shadowColor = "rgba(255,220,120,0.85)";
    ctx.shadowBlur = 22;
    ctx.fill();
    ctx.restore();
  }

  function drawTree(time, speed){
    const cx = W/2;
    const cy = H/2 + 40;

    const rot = time * 0.00095 * speed;

    // å…ˆç”»æ ‘ä½“ç‚¹ï¼ˆæŒ‰æ·±åº¦æ’åºï¼‰
    const pts = treePts.map(p=>{
      const rz = rotY(p.x, p.z, rot);
      const pr = project3D(rz.x, p.y, rz.z);
      return { ...p, rz:rz.z, px:pr.x, py:pr.y, ps:pr.s };
    }).sort((a,b)=>a.rz - b.rz);

    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    for(const p of pts){
      const x = cx + p.px;
      const y = cy + p.py;

      const tw = 0.55 + 0.45*Math.sin(time*0.004 + p.tw);
      const r = (p.size * p.ps) * (0.85 + 0.35*tw);

      if(p.isLight){
        // å½©ç¯ç‚¹ï¼šæ›´äº®æ›´å¤§
        glowDot(x,y, r*6.2, p.color.replace(")", ",0.45)").replace("rgb", "rgba"), 0.95);
        glowDot(x,y, r*3.6, "rgba(255,255,255,0.35)", 0.9);
        ctx.globalAlpha = 0.95;
        ctx.fillStyle = p.color;
      }else{
        // ç»¿è‰²æ ‘ä½“ï¼šæŸ”ä¸€ç‚¹
        glowDot(x,y, r*3.0, "rgba(46,211,106,0.22)", 0.55);
        ctx.globalAlpha = 0.60;
        ctx.fillStyle = "rgba(46,211,106,0.95)";
      }

      ctx.beginPath();
      ctx.arc(x,y, Math.max(0.8, r*0.55), 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    // èºæ—‹ç¯å¸¦ï¼ˆç»•æ ‘ä¸€åœˆäº®å¸¦ï¼‰
    const gPts = garlandPts.map(p=>{
      const wobble = 0.10*Math.sin(p.u*10 + time*0.0012);
      const rz = rotY(p.x, p.z, rot + wobble);
      const pr = project3D(rz.x, p.y, rz.z);
      return { ...p, rz:rz.z, px:pr.x, py:pr.y, ps:pr.s };
    }).sort((a,b)=>a.rz - b.rz);

    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    for(const p of gPts){
      const x = cx + p.px;
      const y = cy + p.py;
      const tw = 0.55 + 0.45*Math.sin(time*0.005 + p.tw);
      const rr = (1.2 + 2.4*tw) * p.ps;

      glowDot(x,y, rr*7.5, "rgba(255,235,160,0.40)", 0.95);
      glowDot(x,y, rr*4.0, "rgba(255,255,255,0.35)", 0.85);

      ctx.globalAlpha = 0.95;
      ctx.fillStyle = "rgba(255,255,255,0.92)";
      ctx.beginPath();
      ctx.arc(x,y, Math.max(0.8, rr*0.55), 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    // å½©çƒ
    const balls = ornaments.map(o=>{
      const rz = rotY(o.x, o.z, rot);
      const pr = project3D(rz.x, o.y, rz.z);
      return { ...o, rz:rz.z, px:pr.x, py:pr.y, ps:pr.s };
    }).sort((a,b)=>a.rz - b.rz);

    ctx.save();
    for(const b of balls){
      const x = cx + b.px;
      const y = cy + b.py;
      const R = b.rad * b.ps;

      // çƒä½“æ¸å˜
      const g = ctx.createRadialGradient(x - R*0.35, y - R*0.35, 0, x, y, R);
      g.addColorStop(0, "rgba(255,255,255,0.95)");
      g.addColorStop(0.22, b.color);
      g.addColorStop(1, "rgba(0,0,0,0.20)");

      ctx.save();
      ctx.globalCompositeOperation = "lighter";
      glowDot(x,y, R*2.6, b.color.replace(")", ",0.25)").replace("rgb","rgba"), 0.9);
      ctx.restore();

      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(x,y,R,0,Math.PI*2);
      ctx.fill();

      // é«˜å…‰ç‚¹
      ctx.fillStyle = "rgba(255,255,255,0.75)";
      ctx.beginPath();
      ctx.arc(x - R*0.25, y - R*0.25, Math.max(1.2, R*0.22), 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    // é¡¶éƒ¨æ˜Ÿæ˜Ÿ + å…‰æ™•
    const top = project3D(0, tree.topY - 36, 0);
    const sx = cx + top.x;
    const sy = cy + top.y;

    ctx.save();
    ctx.globalCompositeOperation = "lighter";
    for(const p of starGlow){
      const rz = rotY(p.x, p.z, rot*0.6);
      const pr = project3D(rz.x, p.y, rz.z);
      glowDot(cx + pr.x, cy + pr.y, p.r, "rgba(255,220,120,0.28)", p.a);
    }
    ctx.restore();

    drawStar(sx, sy, Math.sin(time*0.0012)*0.08);
  }

  // --- state
  let opened=false;
  let time=0;
  let speed=1;

  function frame(){
    if(!opened) return;
    time += 16.6667;

    drawBackground();
    drawSnow();
    drawGround();
    drawTree(time, speed);
    drawGreeting();

    requestAnimationFrame(frame);
  }

  function openCard(){
    if(opened) return;
    opened=true;
    document.body.classList.add("open");
    requestAnimationFrame(frame);
  }

  document.getElementById("openBtn").addEventListener("click", openCard);

  // åˆ‡æ¢æ—‹è½¬é€Ÿåº¦
  window.addEventListener("click", (e)=>{
    if(!opened) return;
    if(e.target && (e.target.id==="openBtn" || e.target.closest?.("#openBtn"))) return;
    speed = (speed === 1) ? 1.9 : 1;
  });

  resize();
})();
</script>
</body>
</html>

